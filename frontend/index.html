<!DOCTYPE html>
<html lang="es">
<head>


  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gestión de Proyectos</title>

  <!-- CSS -->
   <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link rel="stylesheet" href="style.css">
  

 
  <!-- FullCalendar -->
  <link href="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.css" rel="stylesheet">
  
  <!-- jsPDF -->
  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
  
  <!-- Chart.js -->
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  
  <style>
    /* Estilos para el contenedor de Power BI */
    .powerbi-container {
      width: 100%;
      height: calc(100vh - 60px);
      margin-top: 20px;
    }
    
    .powerbi-container iframe {
      width: 100%;
      height: 100%;
      border: none;
    }
    
    /* Mensaje opcional si falla la carga */
    #fallbackMessage {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%,-50%);
      background: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0,0,0,0.2);
      z-index: 1000;
    }

    /* Estilos para el menú contextual de tareas */
    .task-menu {
      position: absolute;
      top: 5px;
      right: 5px;
      cursor: pointer;
      padding: 5px;
      border-radius: 50%;
      transition: background-color 0.2s;
    }

    .task-menu:hover {
      background-color: rgba(0,0,0,0.1);
    }

    .task-context-menu {
      position: absolute;
      right: 0;
      top: 25px;
      background: white;
      border: 1px solid #ddd;
      border-radius: 4px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.2);
      z-index: 100;
      display: none;
    }

    .task-context-menu.show {
      display: block;
    }

    .task-context-menu-item {
      padding: 8px 15px;
      cursor: pointer;
      white-space: nowrap;
    }

    .task-context-menu-item.delete {
      color: #e74c3c;
    }

    /* Dashboard Styles */
    .dashboard-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
    }

    .project-title h1 {
      margin: 0;
      color: #2c3e50;
      font-size: 24px;
    }

    .project-status {
      margin-top: 8px;
      font-size: 14px;
      color: #7f8c8d;
    }

    .status-badge {
      padding: 3px 8px;
      border-radius: 12px;
      font-size: 12px;
      font-weight: bold;
    }

    .status-badge.healthy {
      background: #2ecc71;
      color: white;
    }

    .status-badge.warning {
      background: #f39c12;
      color: white;
    }

    .status-badge.critical {
      background: #e74c3c;
      color: white;
    }

    .project-metrics-summary {
      display: flex;
      gap: 15px;
    }

    .metric-card {
      text-align: center;
      padding: 10px 20px;
      border-radius: 8px;
      background: #f8f9fa;
    }

    .metric-value {
      font-size: 24px;
      font-weight: bold;
      color: #2c3e50;
    }

    .metric-label {
      font-size: 12px;
      color: #7f8c8d;
      text-transform: uppercase;
    }

    .dashboard-main {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }

    .dashboard-row {
      display: flex;
      gap: 20px;
    }

    .dashboard-card {
      flex: 1;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    .dashboard-card.wide {
      flex: 2;
    }

    .dashboard-card h3 {
      margin-top: 0;
      color: #2c3e50;
      font-size: 16px;
      border-bottom: 1px solid #ecf0f1;
      padding-bottom: 10px;
    }

    .progress-container {
      margin: 15px 0;
    }

    .progress-bar {
      height: 10px;
      background: #ecf0f1;
      border-radius: 5px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: #3498db;
      border-radius: 5px;
    }

    .progress-details {
      display: flex;
      justify-content: space-between;
      margin-top: 5px;
      font-size: 12px;
      color: #7f8c8d;
    }

    .progress-metrics {
      display: flex;
      justify-content: space-between;
      margin-top: 15px;
    }

    .progress-metric {
      text-align: center;
    }

    .time-metric {
      margin: 10px 0;
      text-align: center;
    }

    .time-value {
      font-size: 24px;
      font-weight: bold;
      color: #2c3e50;
    }

    .time-label {
      font-size: 12px;
      color: #7f8c8d;
    }

    .chart-legend {
      display: flex;
      justify-content: center;
      gap: 15px;
      margin-top: 10px;
      font-size: 12px;
    }

    .legend-item {
      display: flex;
      align-items: center;
    }

    .legend-item:before {
      content: "";
      display: inline-block;
      width: 10px;
      height: 10px;
      margin-right: 5px;
      border-radius: 50%;
    }

    .legend-item.pending:before { background: #f1c40f; }
    .legend-item.inProgress:before { background: #3498db; }
    .legend-item.completed:before { background: #2ecc71; }

    .risks-container {
      margin-top: 15px;
    }

    .risk-item {
      padding: 8px 12px;
      margin-bottom: 8px;
      border-radius: 4px;
      font-size: 13px;
      display: flex;
      justify-content: space-between;
    }

    .risk-item.high {
      background: #ffebee;
      border-left: 3px solid #e74c3c;
    }

    .risk-item.medium {
      background: #fff8e1;
      border-left: 3px solid #f39c12;
    }

    .risk-item.low {
      background: #e8f5e9;
      border-left: 3px solid #2ecc71;
    }

    .add-risk-btn {
      width: 100%;
      padding: 8px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 10px;
    }

    .resource-list {
      margin-top: 15px;
    }

    .resource-item {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid #ecf0f1;
      font-size: 13px;
    }

    .dashboard-footer {
      display: flex;
      gap: 20px;
      margin-top: 20px;
    }

    .actions-panel, .upcoming-milestones, .quick-actions {
      flex: 1;
      padding: 20px;
      background: #fff;
      border-radius: 8px;
      box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    }

    #requiredActions {
      list-style-type: none;
      padding-left: 0;
    }

    #requiredActions li {
      padding: 8px 0;
      border-bottom: 1px solid #ecf0f1;
    }

    .milestone-item {
      padding: 10px;
      margin-bottom: 8px;
      border-radius: 4px;
      background: #f8f9fa;
      display: flex;
      justify-content: space-between;
    }

    .milestone-item.upcoming {
      border-left: 3px solid #3498db;
    }

    .milestone-item.current {
      border-left: 3px solid #2ecc71;
      font-weight: bold;
    }

    .quick-actions {
      display: flex;
      flex-direction: column;
      gap: 10px;
    }

    .quick-action-btn {
      padding: 10px;
      background: #3498db;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px;
    }

    /* Responsive adjustments */
    @media (max-width: 1200px) {
      .dashboard-row {
        flex-direction: column;
      }
      
      .dashboard-footer {
        flex-direction: column;
      }
    }
  </style>
<style>
  /* Estilos para subtareas */
  .subtasks-section {
    margin-top: 20px;
    padding: 15px;
    background: #f8f9fa;
    border-radius: 5px;
  }
  
  .subtasks-list {
    margin: 10px 0;
  }
  
  .subtask-item {
    display: flex;
    align-items: center;
    padding: 8px;
    margin: 5px 0;
    background: white;
    border-radius: 4px;
  }
  
  .subtask-item input[type="checkbox"] {
    margin-right: 10px;
  }
  
  .subtask-text {
    flex-grow: 1;
  }
  
  .subtask-text.completed {
    text-decoration: line-through;
    color: #777;
  }
  
  .subtask-delete {
    background: none;
    border: none;
    color: #e74c3c;
    cursor: pointer;
  }
  
  .add-subtask-form {
    display: flex;
    margin-top: 10px;
  }
  
  .add-subtask-form input {
    flex-grow: 1;
    padding: 8px;
    border: 1px solid #ddd;
    border-radius: 4px 0 0 4px;
  }
  
  .add-subtask-form button {
    padding: 8px 15px;
    background: #3498db;
    color: white;
    border: none;
    border-radius: 0 4px 4px 0;
    cursor: pointer;
  }
  
  .no-subtasks {
    color: #777;
    font-style: italic;
    padding: 10px;
    text-align: center;
  }
  
  .progress-bar {
    height: 8px;
    background: #e0e0e0;
    border-radius: 4px;
    margin: 10px 0;
    overflow: hidden;
  }
  
  .progress-fill {
    height: 100%;
    background: #2ecc71;
    transition: width 0.3s;
  }
</style>

<style>
  .subtask-progress {
    margin: 8px 0;
  }
  
  .subtask-progress .progress-bar {
    height: 6px;
    background: #e0e0e0;
    border-radius: 3px;
    margin-bottom: 3px;
  }
  
  .subtask-progress .progress-fill {
    height: 100%;
    background: #3498db;
    border-radius: 3px;
  }
  
  .progress-text {
    font-size: 11px;
    color: #666;
    text-align: center;
  }
</style>

</head>

<body>
  <!-- Encabezado -->
  <header>
    <div class="logo">Jackson Technologies</div>

    <div class="header-actions">
      <button id="toggleSidebarBtn" class="blue-btn">☰ Menú</button>
      <button id="newProjectBtn" class="blue-btn">+ Nuevo Proyecto</button>
      <button id="logoutBtn" class="blue-btn" style="background:#e74c3c;">Cerrar Sesión</button>
    </div>
  </header>

  <!-- Contenedor principal -->
  <div class="container">
    <!-- Menú lateral -->
    <aside>

<div style="padding: 15px; font-size: 0.9em; color: #777; border-top: 1px solid #eee; margin-top: 10px;">
    <p><small>Respaldo local</small></p>
    <button id="backupToLocal" style="width: 100%; background: #007bff; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 0.9em; margin-bottom: 5px;">
        💾 Descargar Respaldo
    </button>
    <button id="restoreFromLocal" style="width: 100%; background: #28a745; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer; font-size: 0.9em;">
        📂 Cargar desde archivo
    </button>
</div>

      <h3>Vistas del Proyecto</h3>
      <ul>
        <li id="showBoardView"><i class="fas fa-columns"></i> Board</li>
        <li id="showListView"><i class="fas fa-list"></i> List</li>
        <li id="showCalendarView"><i class="fas fa-calendar-alt"></i> Calendar</li>
        <li id="showGanttView"><i class="fas fa-chart-line"></i> Diagrama Gantt</li>
        <li id="showReportsView"><i class="fas fa-chart-bar"></i> Status del Proyecto</li>
        <li id="showProfitabilityView"><i class="fas fa-coins"></i> Rentabilidad del Proyecto</li>
        <li id="showDashboardView"><i class="fas fa-tachometer-alt"></i> Dashboard</li>
        <li id="showTimeAllocationView"><i class="fas fa-chart-bar"></i> Asignación de Horas</li>
        <li id="showDashboard4DView"><i class="fas fa-chart-network"></i> Dashboard 4D</li>
      </ul>

      <h3>Proyectos</h3>
      <ul id="projectList">
        <!-- Proyectos se cargarán dinámicamente -->
      </ul>

 <!-- === AQUÍ DEBES COLOCAR EL NUEVO CÓDIGO === -->
  <div class="methodology-section">
    <h4>Modo de Trabajo</h4>
    <select id="methodologySelector">
      <option value="hybrid">Híbrido</option>
      <option value="agile">Ágil</option>
      <option value="traditional">Tradicional</option>
    </select>
  </div>
  <!-- === FIN DEL NUEVO CÓDIGO === -->
    </aside>

    <!-- Contenido principal -->
    <main>
      <!-- Vista Board (Kanban) -->
      <div id="boardView" class="view-content">
        <!-- Contenido existente del board view -->
        <div class="project-info">
          <h2>Proyecto: <span id="projectName">Nombre del Proyecto</span></h2>
          <div class="action-buttons">
            <button id="newTaskBtn" class="action-btn new-task">
              <i class="fas fa-plus-circle"></i> Nueva Tarea
            </button>
          </div>
        </div>

        <!-- Filtros -->
        <div class="filter-bar">
          <label>Asignado a:
            <select id="filterAssignee">
              <option value="">Todos</option>
            </select>
          </label>
          <label>Prioridad:
            <select id="filterPriority">
              <option value="">Todas</option>
              <option value="baja">Baja</option>
              <option value="media">Media</option>
              <option value="alta">Alta</option>
            </select>
          </label>
          <label>Estado:
            <select id="filterStatus">
              <option value="">Todos</option>
              <option value="pending">Pendiente</option>
              <option value="inProgress">En Progreso</option>
              <option value="completed">Completado</option>
              <option value="overdue">Rezagado</option>
            </select>
          </label>
          <button id="clearFiltersBtn" class="blue-btn">Limpiar</button>
        </div>

        <!-- Kanban Board -->
        <div class="kanban-board">
          <div class="column" id="pendingTasks">
            <h3>Pendientes</h3>
            <div class="tasks" id="pendingList"></div>
          </div>
          <div class="column" id="inProgressTasks">
            <h3>En progreso</h3>
            <div class="tasks" id="inProgressList"></div>
          </div>
          <div class="column" id="completedTasks">
            <h3>Completados</h3>
            <div class="tasks" id="completedList"></div>
          </div>
          <div class="column" id="overdueTasks">
            <h3>Rezagados</h3>
            <div class="tasks" id="overdueList"></div>
          </div>
        </div>
      </div>

      <!-- Vista Lista -->
      <div id="listView" class="view-content hidden">
        <!-- Contenido existente del list view -->
        <div class="list-view-header">
          <h2>Proyecto: <span id="projectNameList">Nombre del Proyecto</span></h2>
          <div class="action-buttons">
            <button id="newTaskBtnList" class="action-btn new-task">
              <i class="fas fa-plus-circle"></i> Nueva Tarea
            </button>
          </div>
        </div>

        <!-- Filtros para List View -->
        <div class="filter-bar list-filters">
          <div class="filter-group">
            <label>Asignado a:
              <select id="filterAssigneeList">
                <option value="">Todos</option>
              </select>
            </label>
          </div>
          <div class="filter-group">
            <label>Prioridad:
              <select id="filterPriorityList">
                <option value="">Todas</option>
                <option value="baja">Baja</option>
                <option value="media">Media</option>
                <option value="alta">Alta</option>
              </select>
            </label>
          </div>
          <div class="filter-group">
            <label>Estado:
              <select id="filterStatusList">
                <option value="">Todos</option>
                <option value="pending">Pendiente</option>
                <option value="inProgress">En Progreso</option>
                <option value="completed">Completado</option>
                <option value="overdue">Rezagado</option>
              </select>
            </label>
          </div>
          <div class="filter-group">
            <label>Desde:
              <input type="date" id="filterStartDateList">
            </label>
          </div>
          <div class="filter-group">
            <label>Hasta:
              <input type="date" id="filterEndDateList">
            </label>
          </div>
          <button id="clearFiltersBtnList" class="blue-btn">Limpiar</button>
        </div>

        <!-- Tabla de tareas -->
        <div class="table-container">
          <table id="taskTable" class="task-list-table">
            <thead>
              <tr>
                <th>Tarea</th>
                <th>Fecha Inicio</th>
                <th>Fecha Límite</th>
                <th>Estado</th>
                <th>Asignado a</th>
                <th>Prioridad</th>
              </tr>
            </thead>
            <tbody id="taskTableBody">
              <!-- Las tareas se cargarán dinámicamente aquí -->
            </tbody>
          </table>
        </div>
      </div>

      <!-- Vista Calendario -->
      <div id="calendarView" class="view-content hidden">
        <!-- Contenido existente del calendar view -->
        <div class="project-info">
          <h2>Proyecto: <span id="projectNameCalendar">Nombre del Proyecto</span></h2>
          <div class="action-buttons">
            <button id="newTaskBtnCalendar" class="action-btn new-task">
              <i class="fas fa-plus-circle"></i> Nueva Tarea
            </button>
          </div>
        </div>
        
        <!-- Filtros para Calendar View -->
        <div class="filter-bar calendar-filters">
          <label>Asignado a:
            <select id="filterAssigneeCalendar">
              <option value="">Todos</option>
            </select>
          </label>
          <label>Prioridad:
            <select id="filterPriorityCalendar">
              <option value="">Todas</option>
              <option value="baja">Baja</option>
              <option value="media">Media</option>
              <option value="alta">Alta</option>
            </select>
          </label>
          <label>Estado:
            <select id="filterStatusCalendar">
              <option value="">Todos</option>
              <option value="pending">Pendiente</option>
              <option value="inProgress">En Progreso</option>
              <option value="completed">Completado</option>
              <option value="overdue">Rezagado</option>
            </select>
          </label>
          <button id="clearFiltersCalendarBtn" class="blue-btn">Limpiar</button>
        </div>

        <div id="calendarContainer">
          <div id="calendar"></div>
        </div>
      </div>

      <!-- Vista Diagrama Gantt -->
      <div id="ganttView" class="view-content hidden">
        <!-- Contenido existente del gantt view -->
        <div class="project-info">
          <h2>Proyecto: <span id="projectNameGantt">Nombre del Proyecto</span></h2>
        </div>
        
        <!-- Filtros para Gantt View -->
        <div class="filter-bar gantt-filters">
          <label>Asignado a:
            <select id="filterAssigneeGantt">
              <option value="">Todos</option>
            </select>
          </label>
          <label>Prioridad:
            <select id="filterPriorityGantt">
              <option value="">Todas</option>
              <option value="baja">Baja</option>
              <option value="media">Media</option>
              <option value="alta">Alta</option>
            </select>
          </label>
          <button id="clearFiltersGanttBtn" class="blue-btn">Limpiar</button>
        </div>
        
        <!-- Contenedor del diagrama Gantt -->
        <div id="ganttContainer" style="width: 100%; height: 80vh; overflow-x: auto;"></div>
      </div>

      <!-- Vista Reportes -->
      <div id="reportsView" class="view-content hidden">
        <!-- Contenido existente del reports view -->
        <div class="project-info-reports">
          <h2>Proyecto: <span id="projectNameReports">Nombre del Proyecto</span></h2>
        </div>
        
        <section class="statistics">
          <!-- Filtros -->
          <div class="filter-bar reports-filters">
            <label>Asignado a:
              <select id="filterAssigneeReports">
                <option value="">Todos</option>
              </select>
            </label>
            <label>Prioridad:
              <select id="filterPriorityReports">
                <option value="">Todas</option>
                <option value="baja">Baja</option>
                <option value="media">Media</option>
                <option value="alta">Alta</option>
              </select>
            </label>
            <label>Estado:
              <select id="filterStatusReports">
                <option value="">Todos</option>
                <option value="pending">Pendiente</option>
                <option value="inProgress">En Progreso</option>
                <option value="completed">Completado</option>
                <option value="overdue">Rezagado</option>
              </select>
            </label>
            <button id="clearFiltersReportsBtn" class="blue-btn">Limpiar</button>
          </div>

          <h3 class="stats-title">Estadísticas del Proyecto</h3>
          <div class="stats-cards">
            <div class="stat-box totalTask">
              <div class="stat-content">
                <span class="stat-text">Total</span>
                <span class="stat-number" id="totalTaskCount">0</span>
              </div>
            </div>
            
            <div class="stat-box pending">
              <div class="stat-content">
                <span class="stat-text">Pendientes</span>
                <span class="stat-number" id="pendingCount">0</span>
              </div>
            </div>

            <div class="stat-box inProgress">
              <div class="stat-content">
                <span class="stat-text">En Progreso</span>
                <span class="stat-number" id="inProgressCount">0</span>
              </div>
            </div>
            
            <div class="stat-box completed">
              <div class="stat-content">
                <span class="stat-text">Completados</span>
                <span class="stat-number" id="completedCount">0</span>
              </div>
            </div>
            
            <div class="stat-box overdue">
              <div class="stat-content">
                <span class="stat-text">Rezagados</span>
                <span class="stat-number" id="overdueCount">0</span>
              </div>
            </div>
          </div>

          <!-- === BARRA DE AVANCE INDEPENDIENTE PARA STATUS/REPORTS === -->
<div class="reports-progress-section">
    <h3>Avance del Proyecto</h3>
    <div class="reports-progress-container">
        <div class="reports-progress-bar">
            <div class="reports-progress-fill" id="reportsProjectProgressFill"></div>
        </div>
    </div>
    <div class="reports-progress-text" id="reportsProjectProgressText">0% Completado</div>
</div>

          <!-- Contenedor para gráfico y tarjetas de tiempo -->
          <div class="report-content">
            <!-- Cuadros izquierda PEGADOS a la gráfica -->
            <div class="left-time-cards">
  <div class="time-card">
    <h4>Fecha de Inicio</h4>
    <p id="projectStartDateReports">--/--/--</p>
  </div>
  <div class="time-card">
    <h4>Fecha de Fin</h4>
    <p id="projectEndDateReports">--/--/--</p>
  </div>
  <div class="time-card">
    <h4>Tiempo Total</h4>
    <p id="totalProjectTime">0 horas</p>
  </div>
</div>


            <!-- Gráfica de pastel PEGADA a los cuadros -->
            <div class="chart-center">
              <div class="chart-container">
                <canvas id="pieChart"></canvas>
              </div>
            </div>

            <!-- Cuadros derecha (opcional si los quieres mantener) -->
            
              <div class="right-time-cards">
        <div class="time-card">
            <h4>Tiempo Estimado</h4>
            <p id="totalEstimatedTimeStatus">0 horas</p> <!-- *** ID CORRECTO *** -->
        </div>
        <div class="time-card">
            <h4>Tiempo Registrado</h4>
            <p id="totalLoggedTimeStatus">0 horas</p> <!-- *** ID CORRECTO *** -->
        </div>
        <div class="time-card">
            <h4>Tiempo Restante</h4>
            <p id="remainingTimeStatus">0 horas</p> <!-- *** ID CORRECTO *** -->
        </div>
    </div>
</div>

          <div id="projectStatusLabelContainer" class="stat-box" style="margin: 0 auto;">
            <div>
                <strong>Estado del Proyecto</strong><br>
                <span id="projectStatusLabel" class="status-badge">Cargando...</span>
            </div>
          </div>
          <div id="projectStatusLabelContainer" style="text-align: center; margin: 20px 0;">
          </div>

          <!-- Botón PDF -->
          <div class="pdf-btn-container">
            <button id="generatePdfBtn" class="pdf-btn">Generar Reporte PDF</button>
          </div>
        </section>
      </div>

      <!-- Vista Rentabilidad -->
      <div id="profitabilityView" class="view-content hidden">
        <!-- Contenedor para Power BI -->
        <div class="powerbi-container">
          <iframe 
            width="100%" 
            height="100%" 
            <iframe title="rentabilidad de proyectos" width="1140" height="541.25" src="https://app.powerbi.com/reportEmbed?reportId=ac0ac773-e33a-49c7-8fe9-c6422fca14a6&autoAuth=true&ctid=c87402f1-0393-4ddb-a369-304ecb6e1a18" frameborder="0" allowFullScreen="true"></iframe>
            frameborder="0" 
            allowFullScreen="true">
          </iframe>
        </div>
        
        <!-- Mensaje opcional si falla la carga -->
        <div id="fallbackMessage">
          <h3>No se pudo cargar el dashboard</h3>
          <p>Por favor verifica:</p>
          <ol>
            <li>Que el informe esté publicado en Power BI Service</li>
            <li>Que hayas reemplazado "TU_ID_DEL_INFORME_AQUI" con el ID real</li>
            <li>Tu conexión a internet</li>
          </ol>
        </div>
      </div>


<!-- Vista Reporte de Asignación de Horas -->
<div id="timeAllocationView" class="view-content hidden">
    <div class="project-info">
        <h2>Reporte: Registro de horas trabajadas por proyecto </h2>
    </div>
   
    
<!-- Filtros -->
<div class="filter-bar">
    <label for="filterTimeAllocationYear">Año:
        <select id="filterTimeAllocationYear">
            <option value="all">Todos</option>
            <!-- Las opciones se poblarán dinámicamente -->
        </select>
    </label>
    <label for="filterTimeAllocationMonth">Mes:
        <select id="filterTimeAllocationMonth">
            <option value="all">Todos</option>
            <!-- Las opciones se poblarán dinámicamente -->
        </select>
    </label>
    <label for="filterTimeAllocationProject">Proyecto:
        <select id="filterTimeAllocationProject">
            <option value="all">Todos</option>
            <!-- Las opciones se poblarán dinámicamente -->
        </select>
    </label>
    <label for="filterTimeAllocationAssignee">Asignado:
        <select id="filterTimeAllocationAssignee">
            <option value="all">Todos</option>
            <!-- Las opciones se poblarán dinámicamente -->
        </select>
    </label>
    <button id="applyTimeAllocationFiltersBtn">Aplicar Filtros</button>
</div>
    <!-- Contenido del Reporte -->
    <div class="time-allocation-content">
        <div class="time-allocation-table-container">
            <table class="time-allocation-table">
                <thead>
                    <tr>
                        <th>Asignado</th>
                        <th>Proyecto</th>
                        <th>Mes</th>
                        <th>Horas Registradas</th>
                    </tr>
                </thead>
                <tbody id="timeAllocationTableBody">
                    <!-- Se llenará dinámicamente -->
                </tbody>
            </table>
        </div>
        <div class="time-allocation-chart-container">
            <canvas id="timeAllocationChart"></canvas>
        </div>
    </div>
</div>



      <!-- Vista Dashboard -->
    <div id="dashboardView" class="view-content hidden">
        <div class="dashboard-header">
          <div class="project-title">
            <h1 id="projectNameDashboard">Nombre del Proyecto</h1>
             <h2 id="dashboardTitle">
  <strong>🔁 Vista Completa del Proyecto</strong><br>
  <small>Combina avance y control</small>
</h2>

             <div class="project-status">
              <span id="projectHealthStatus">Estado: <span class="status-badge healthy">En tiempo</span></span>
              <span id="projectTimeline">Fecha Inicio: <span id="projectStartDate">--/--/--</span> - Fecha Fin: <span id="projectEndDate">--/--/--</span> <strong>(<span id="projectTotalDays">0</span> días)</strong></span>
            </div>
          </div>


<!-- Dentro del dashboard, arriba del contenido -->
<div id="modeIndicator" class="mode-indicator mode-indicator-hybrid">
  <i class="fas fa-bolt"></i> <span id="currentModeText">Híbrido</span>
</div>



          <div class="project-metrics-summary" style="transform: translateX(150px); display: flex; gap: 24px;">
            <div class="metric-card">
              <div class="metric-value" id="completionPercentage">0%</div>
              <div class="metric-label">Avance</div>
            </div>
            <div class="metric-card">
              <div class="metric-value" id="budgetConsumption">0%</div>
              <div class="metric-label">Presupuesto en tiempo</div>
            </div>
            <div class="metric-card">
              <div class="metric-value" id="riskLevel">0</div>
              <div class="metric-label">Riesgos</div>
            </div>
          </div>
        </div>


<!-- Mensaje de ayuda contextual -->
  <div class="mode-help-text">
    <small id="modeHelpMessage">
      En modo Híbrido, se muestra una visión completa del proyecto: avance, riesgos y control de tiempo.
    </small>
  </div>


        <div class="dashboard-main">

    <!-- Fila 1: Progreso y Control de Tiempo -->
    <div class="dashboard-grid-row">
        <!-- Tarjeta: Progreso del Proyecto -->
        <div class="dashboard-card">
            <h3>Progreso del Proyecto</h3>
            <div class="progress-container">
                <div class="progress-percentage" id="progressPercentage">0%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="projectProgressFillDash"></div>
                </div>
            </div>
              <div class="progress-metrics">
                <div class="progress-metric">
                  <span class="metric-value" id="totalTasksMetric">24</span>
                  <span class="metric-label">Total</span>
                </div>
                <div class="progress-metric">
                  <span class="metric-value" id="pendingTasksMetric">5</span>
                  <span class="metric-label">Pendientes</span>
                </div>
                <div class="progress-metric">
                  <span class="metric-value" id="inProgressTasksMetric">8</span>
                  <span class="metric-label">En Progreso</span>
                </div>
                <div class="progress-metric">
                  <span class="metric-value" id="completedTasksMetric">11</span>
                  <span class="metric-label">Completadas</span>
                </div>
                <div class="progress-metric">
                  <span class="metric-value" id="overdueTasksMetric">2</span>
                  <span class="metric-label">Rezagadas</span>
                </div>
              </div>
            </div>

            <div class="dashboard-card">
              <h3>Control de Tiempo</h3>
              <div class="time-metric">
                <div class="time-value" id="totalProjectTimeDash">0h</div>
                <div class="time-label">Total</div>
              </div>
              <div class="time-metric">
                <div class="time-value" id="totalEstimatedDash">120h</div>
                <div class="time-label">Estimado</div>
              </div>
              <div class="time-metric">
                <div class="time-value" id="totalLoggedDash">85h</div>
                <div class="time-label">Registrado</div>
              </div>
              <div class="time-metric">
                <div class="time-value" id="remainingTimeDash">35h</div>
                <div class="time-label">Restante</div>
              </div>
              <div class="time-feedback" id="timeFeedback"></div>
            
            </div>
          </div>

          <!-- Fila 2: Distribución y Riesgos -->
          <div class="dashboard-row">
            <div class="dashboard-card">
              <h3>Distribución de Tareas</h3>
              <canvas id="tasksDistributionChart"></canvas>
              <div class="chart-legend">
                <div class="legend-item pending">Pendientes <span id="pendingCountDash">0</span></div>
                <div class="legend-item inProgress">En Progreso <span id="inProgressCountDash">0</span></div>
                <div class="legend-item completed">Completadas <span id="completedCountDash">0</span></div>
              </div>
            </div>

            <div class="dashboard-card">
              <h3>Riesgos y Problemas</h3>
              <div class="risks-container" id="risksContainer"></div>
              <button class="add-risk-btn" id="addRiskBtn">+ Reportar Nuevo Riesgo</button>
            </div>
 </div>
           
<div class="dashboard-card wide">
    <h3>Seguimiento de Horas</h3>
    
    <!-- Filtros -->
    <div class="time-tracking-filters">
      <div class="filter-group">
        <label>Año:</label>
        <select id="timeTrackingYear">
          <option value="2025" selected>2025</option>
          <option value="2026">2026</option>
          <option value="2027">2027</option>
          <option value="2028">2028</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label>Mes:</label>
        <select id="timeTrackingMonth">
          <option value="all">Todos</option>
          <option value="1">Enero</option>
          <option value="2">Febrero</option>
          <option value="3">Marzo</option>
          <option value="4">Abril</option>
          <option value="5">Mayo</option>
          <option value="6">Junio</option>
          <option value="7">Julio</option>
          <option value="8">Agosto</option>
          <option value="9">Septiembre</option>
          <option value="10">Octubre</option>
          <option value="11">Noviembre</option>
          <option value="12">Diciembre</option>
        </select>
      </div>
      
      <div class="filter-group">
        <label>Proyecto:</label>
        <select id="timeTrackingProject">
          <option value="all">Todos</option>
          <!-- Se llenará dinámicamente -->
        </select>
      </div>
      
      <div class="filter-group">
        <label>Asignado:</label>
        <select id="timeTrackingAssignee">
          <option value="all">Todos</option>
          <!-- Se llenará dinámicamente -->
        </select>
      </div>
      
         <button id="applyTimeTrackingFilters">Aplicar</button>
  </div>
    
    <!-- Gráfica -->
    <div class="time-tracking-chart-container">
      <canvas id="timeTrackingChart"></canvas>
    </div>
    
    <!-- Tabla -->
    <div class="time-tracking-table-container">
      <table class="time-tracking-table">
        <thead>
          <tr>
            <th>Asignado</th>
            <th>Proyecto</th>
            <th>Horas</th>
            <th>Promedio/día</th>
            <th>Último registro</th>
          </tr>
        </thead>
        <tbody id="timeTrackingTableBody">
          <!-- Se llenará dinámicamente -->
        </tbody>
      </table>
    </div>
  </div>
</div>

  
          <!-- Fila 3: Acciones y Hitos -->
          <div class="dashboard-footer">
           <!-- Panel de Acciones Requeridas -->
<!-- Sección de Acciones Requeridas -->

<!-- Acciones Requeridas -->
<div class="actions-panel">
  <div class="actions-header">
    <h3>Acciones Requeridas</h3>
  </div>
    <ul id="requiredActions"></ul>
<button id="addActionBtn" class="add-action-btn">+ Agregar</button>
</div>


<!-- Próximos Hitos -->
<div class="upcoming-milestones">
  <div class="milestones-header">
    <h3>Próximos Hitos</h3>
  </div>
<div id="milestonesList"></div>
  <button id="addMilestoneBtn" class="add-milestone-btn">+ Agregar</button>
  
</div>          


              <div class="quick-actions">
              <h3>Accesos Rápidos</h3>
              <button class="quick-action-btn" id="newTaskBtnDashboard">+ Nueva Tarea</button>
              <button class="quick-action-btn" id="generatePdfBtnDashboard">📄 Generar PDF</button>
              <button class="quick-action-btn" id="switchViewBtnDashboard">🔁 Cambiar Vista</button>
            </div>
          </div>
        </div>
      </div>
    </main>

 
    <!-- Modales -->
    <div id="createTaskModal" class="modal">
      <div class="modal-content">
        <span class="close">&times;</span>
        <h3>Nueva Tarea</h3>
        <form id="createTaskForm" class="new-task-form">
          <div class="form-group">
            <label for="taskName">Nombre*</label>
            <input type="text" id="taskName" required>
          </div>
          
          <div class="form-group">
            <label for="taskDescription">Descripción</label>
            <textarea id="taskDescription" rows="4"></textarea>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="taskPriority">Prioridad</label>
              <select id="taskPriority">
                <option value="baja">Baja</option>
                <option value="media">Media</option>
                <option value="alta">Alta</option>
              </select>
            </div>
            
            <div class="form-group">
              <label for="taskAssignee">Asignar a:</label>
              <input type="text" id="taskAssignee">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="taskStartDate">Fecha Inicio:</label>
              <input type="date" id="taskStartDate">
            </div>
            
            <div class="form-group">
              <label for="taskDeadline">Fecha límite</label>
              <input type="date" id="taskDeadline">
            </div>
          </div>
          
          <div class="form-row">
            <div class="form-group">
              <label for="estimatedHours">Tiempo estimado (horas)</label>
              <input type="number" id="estimatedHours" min="0" step="0.5">
            </div>
            
            <div class="form-group">
              <label for="fileUpload">Archivo adjunto:</label>
              <input type="file" id="fileUpload">
            </div>
          </div>
          
          <div class="form-actions">
            <button type="button" id="cancelTaskBtn" class="cancel-btn">Cancelar</button>
            <button type="submit" class="btn-save">Guardar Tarea</button>
          </div>
        </form>
      </div>
    </div>

    <div id="taskDetailsModal" class="modal">
      <div class="modal-content">
        <span class="close-detail">&times;</span>
        <h3>Detalles de la Tarea</h3>
        <div id="taskDetails"></div>
      </div>
    </div>

    <!-- Notificación -->
    <div id="notification" class="notification"></div>
  </div>

  <!-- Scripts -->
   <script src="https://cdn.jsdelivr.net/npm/fullcalendar@6.1.8/index.global.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="time-tracking.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
  <script src="script.js"></script>
  
  <script>
    // Detectar si el iframe carga correctamente
    document.querySelector('#profitabilityView iframe').onerror = function() {
      document.getElementById('fallbackMessage').style.display = 'block';
    };

    // Función para renderizar el dashboard
    function renderDashboard() {
      const project = projects[currentProjectIndex];
      if (!project) return;
      
      // Actualizar información básica
      document.getElementById('projectNameDashboard').textContent = project.name;
      
      // Calcular KPIs
      const stats = getStats();
      const timeStats = getTimeStats();
      const completionPercentage = stats.total > 0 
        ? Math.round((stats.completed / stats.total) * 100) 
        : 0;
      
      // Actualizar métricas
      document.getElementById('completionPercentage').textContent = `${completionPercentage}%`;
      document.getElementById('completedTasksDash').textContent = stats.completed;
      document.getElementById('totalTasksDash').textContent = stats.total;
      document.getElementById('onTimeTasks').textContent = stats.total - stats.overdue;
      document.getElementById('delayedTasks').textContent = stats.overdue;
      
      // Actualizar tiempos
      document.getElementById('totalEstimatedDash').textContent = `${timeStats.totalEstimated.toFixed(1)}h`;
      document.getElementById('totalLoggedDash').textContent = `${timeStats.totalLogged.toFixed(1)}h`;
      document.getElementById('remainingTimeDash').textContent = `${timeStats.remaining.toFixed(1)}h`;
      
      // Actualizar gráficos
      renderDashboardCharts();
      
      // Actualizar estado del proyecto
      updateProjectHealthStatus();
      
      // Actualizar hitos y acciones
      updateMilestones();
      updateRequiredActions();
    }

    function renderDashboardCharts() {
      const stats = getStats();
      const timeStats = getTimeStats();
      
      // Gráfico de distribución de tareas
      const tasksCtx = document.getElementById('tasksDistributionChart').getContext('2d');
      if (window.tasksChart) window.tasksChart.destroy();
      
      window.tasksChart = new Chart(tasksCtx, {
        type: 'doughnut',
        data: {
          labels: ['Pendientes', 'En Progreso', 'Completadas'],
          datasets: [{
            data: [stats.pending, stats.inProgress, stats.completed],
            backgroundColor: ['#f1c40f', '#3498db', '#2ecc71']
          }]
        },
        options: {
          cutout: '70%',
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
      
      // Gráfico de tiempo
      const timeCtx = document.getElementById('timeChart').getContext('2d');
      if (window.timeChart) window.timeChart.destroy();
      
      window.timeChart = new Chart(timeCtx, {
        type: 'bar',
        data: {
          labels: ['Estimado', 'Registrado', 'Restante'],
          datasets: [{
            data: [timeStats.totalEstimated, timeStats.totalLogged, timeStats.remaining],
            backgroundColor: ['#3498db', '#2ecc71', '#f39c12']
          }]
        },
        options: {
          scales: {
            y: {
              beginAtZero: true
            }
          },
          plugins: {
            legend: {
              display: false
            }
          }
        }
      });
    }

    function updateProjectHealthStatus() {
      const project = projects[currentProjectIndex];
      const stats = getStats();
      const completionPercentage = stats.total > 0 
        ? Math.round((stats.completed / stats.total) * 100 
        : 0;
      
      const healthStatus = document.getElementById('projectHealthStatus');
      const badge = healthStatus.querySelector('.status-badge');
      
      badge.classList.remove('healthy', 'warning', 'critical');
      
      if (completionPercentage >= 75) {
        badge.classList.add('healthy');
        badge.textContent = 'En Tiempo';
      } else if (completionPercentage >= 50) {
        badge.classList.add('warning');
        badge.textContent = 'En riesgo';
      } else {
        badge.classList.add('critical');
        badge.textContent = 'Crítico';
      }
    }

    function updateMilestones() {
      // Implementar lógica para identificar hitos próximos
    }

    function updateRequiredActions() {
      // Implementar lógica para identificar acciones requeridas
    }

    // Event listeners para el dashboard
    document.getElementById('showDashboardView')?.addEventListener('click', () => {
      showView('dashboard');
      renderDashboard();
    });

    document.getElementById('newTaskBtnDashboard')?.addEventListener('click', () => {
      document.getElementById('createTaskModal').style.display = 'block';
    });

    document.getElementById('generatePdfBtnDashboard')?.addEventListener('click', generateProjectReport);

    document.getElementById('switchViewBtnDashboard')?.addEventListener('click', () => {
      showView('board');
    });
 
</body>
</html>